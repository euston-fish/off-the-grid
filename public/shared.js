'use strict';var d;Array.j=function(...a){return(a[0]||[]).map((b,e)=>a.map((a)=>a[e]))};d=Array.prototype;d.j=function(...a){return Array.j(this,...a)};d.G=function(){return this.reduce((a,b)=>a+b,0)};d.product=function(){return this.reduce((a,b)=>a*b,1)};d.add=function(...a){return this.j(...a).map((a)=>a.G())};d.D=function(){return this.map((a)=>-a)};d.sub=function(a){return this.add(a.D())};d.scale=function(a){return this.map((b)=>b*a)};d.m=function(...a){return Array.m(this,...a)};
d.C=function(){return this.reduce((a,b)=>a.concat(b),[])};Array.m=function(a,...b){return void 0===a?[[]]:a.map((a)=>Array.m(...b).map((b)=>[a,...b])).C()};Array.prototype.w=function(){return Array(Math.ceil(this.length/2)).fill().map((a,b)=>this.slice(2*b,2*b+2))};const k=([a,b],[e,c])=>[a+e,b+c],m=([a,b])=>[-a,-b],n=(a,b)=>b.scale(32).sub(a),p=(a,b)=>b.add(a).scale(.03125).map(Math.floor);function t(a,b,e,c){this.source=a;this.i=b;this.offset=e||[0,0];this.size=c||k(b,m(this.offset))}d=t.prototype;d.keys=function*(){for(let a=0;a<this.size[0];a++)for(let b=0;b<this.size[1];b++)yield[a,b]};function u([a,b],[,e]){return a*e+b}d.get=function(a){if(!(0>a[0]||a[0]>this.size[0]||0>a[1]||a[1]>this.size[1]))return this.source[u(k(a,this.offset),this.i)]};d.set=function(a,b){0>a[0]||a[0]>this.size[0]||0>a[1]||a[1]>this.size[1]||(this.source[u(k(a,this.offset),this.i)]=b)};
d.update=function(a,b){this.set(a,b(this.get(a),a))};d.I=function(a){for(let b of this.keys())this.update(b,a)};d.shift=function(a){return new t(this.source,this.i,k(this.offset,a),k(this.size,m(a)))};d.F=function(a){return new t(this.source,this.i,this.offset,a)};d.window=function(a,b){return this.shift(a).F(b)};d.toJSON=function(){return Array.from(this.keys()).map((a)=>this.get(a))};d.g=function(a){Array.from(this.keys()).j(a).forEach(([a,e])=>this.set(a,e))};function v(a,b){this.coords=a;let {a:e,b:c}=b||{};this.a=e||new t(new Uint8Array(256),[16,16]);this.b=c||new t(new Uint8Array(256),[16,16])}var w=([a,b])=>[Math.floor(a/16),Math.floor(b/16)];v.prototype.A=function(a){return a.sub(this.coords.scale(16))};v.prototype.g=function({terrain:a,water:b}){this.a.g(a);this.b.g(b)};v.prototype.toJSON=function(){return{terrain:this.a.toJSON(),water:this.b.toJSON()}};function x(){this.f={};this.u={};this.s={};this.o=new EventTarget}x.prototype.get=function(a){void 0===this.f[a]&&(this.f[a]=new v(a));1E3<new Date-(this.u[a]||0)&&!(a in this.s)&&(this.s[a]=!0,y(a).then((b)=>this.f[a].g(b)).then(()=>this.u[a]=new Date).then(()=>delete this.s[a]).then(()=>setTimeout(()=>this.get(a),1050)).then(()=>this.dispatchEvent(new Event("update",a))));return this.f[a]};function y(a){return window.fetch(`block/${a[0]}/${a[1]}`).then((a)=>a.json())}
x.prototype.addEventListener=function(...a){this.o.addEventListener(...a)};x.prototype.removeEventListener=function(...a){this.o.removeEventListener(...a)};x.prototype.dispatchEvent=function(...a){this.o.dispatchEvent(...a)};const z=Uint8Array.from("0061736d0100000001330a60027f7f017f6000017c60037f7f7f0060000060027d7d017d6000017f60017f0060037f7f7f017f60027f7f0060017f017e02190203656e760672616e646f6d000103656e7604706f7766000403100f0002030403050606060300000806090405017001040405030100310609017f0141b08ec0010b073805066d656d6f7279020004696e69740004047469636b00060761646472657373000713727573745f65685f706572736f6e616c697479000b0909010041010b030d0f100af31a0fd20102037f017d0240200041ffff3f4d0440200141ffff3f4b0d010240200041908cc0006a2d00002203200041900c6a2d00002204417d6a41ff01714d0d002003200141908cc0006a2d00002200490d00436f12833a43cdcc4c3d43cdcccc3e200320044d22021b2205200041ff0171200141900c6a2d00004d1b200520021b200320006b41ff0171b394220520058e2205931000b65e027f41808080807820058b430000004f5d450d001a2005a80b6a21020b20020f0b41b40b2000418080c0001003000b41c40b2001418080c0001003000b7c01017f230041306b2203240020032002360204200320013602002003412c6a4101360200200341146a41023602002003411c6a410236020020034101360224200341fc0b3602082003410236020c200341b80a3602102003200341046a360220200320033602282003200341206a360218200341086a2000100e000b9d0303027f027d017c41807e2100024003402000450d01200041918e80016a027f41001000440000000000007040a2220444000000000000f0416320044400000000000000006671450d001a2004ab0b3a0000200041016a21000c000b000b41002100024003402000418080c000460d01200041900c6a027f4100200041ff0771b22202430000003e942000410a76b22203430000003e941005430000003f92433333333f942002430000c041952003430000c041951005430000803f92436666e63f94922002430000803c942003430000803c941005430000803f9243cdcc4c3f949243abaa2a42942202430000804f5d200243000000006071450d001a2002a90b3a0000200041016a21000c000b000b418080402100024003402000450d01200041908c80016a027f4100200041908cc0006a2d00002201410a6a41ff0171b32001417d6a41ff0171b32202931000b69420029222024300007f4320024300007f435d1b2202430000000020024300000000601b2202430000804f5d200243000000006071450d001a2002a90b3a0000200041016a21000c000b000b0bb10502047f067d027f4100430000803f43000000002000200020019243ae67bb3e9422082000928e2206200620082001928e220892438c65583e94220793932200200120082007939322015e22031b2207430000804f5d200743000000006071450d001a2007a90b027f41808080807820068b430000004f5d450d001a2006a80b22026a027f41004300000000430000803f20031b2206430000804f5d200643000000006071450d001a2006a90b027f41808080807820088b430000004f5d450d001a2008a80b22036a41ff017141918c80016a2d00006a41ff017141918c80016a2d0000410c7021042001200693438c65583e9221062000200793438c65583e922108200143000080bf922107200043000080bf9221092002200341016a41ff017141918c80016a2d00006a41016a41ff017141918c80016a2d0000410c702105430000003f200020009493200120019493220a43000000005d450440200341ff017141918c80016a2d000020026a41ff017141918c80016a2d00002102200a4300008040100120002002410c7041036c418a086a22022f0000200241026a2d0000411074722202411874411875b29420012002411074411875b2949294210b0b2007438c65d83e9221002009438c65d83e9221014300000000210743000000002109430000003f200820089493200620069493220a43000000005d450440200a430000804010012008200441ff017141036c418a086a22022f0000200241026a2d0000411074722202411874411875b29420062002411074411875b294929421090b430000003f200120019493200020009493220643000000005d4504402006430000804010012001200541ff017141036c418a086a22022f0000200241026a2d0000411074722202411874411875b29420002002411074411875b294929421070b200b2009922007924300008c42940be201010b7f024003402002418008460d012002410a7422004180f83f71210420004180086a4180f83f71210a41002103024003402003418008460d01200341ff0771220120047222002001200a7222011002210520012000100221062000200341016a220341ff07712004722207100221082007200010022109200041908cc0006a2200200620056b20002d00006a3a0000200141908cc0006a2201200520066b20012d00006a3a00002000200920086b20002d00006a3a0000200741908cc0006a2200200820096b20002d00006a3a00000c000b000b200241016a21020c000b000b0b050041900c0b5c000240024041988e80012802004101460440419c8e8001419c8e800128020041016a220036020020004103490d010c020b41988e80014281808080103703000b41a48e80012802002200417f4c0d0041a48e800120003602000b000b3f01027f230041106b22012400027f2000280208220220020d001a41d40b100a000b1a2001200029020c3703002001200041146a29020037030820011008000b6602017f037e230041306b22012400200029021021022000290208210320002902002104200141146a41003602002001200437031820014201370204200141b40a3602102001200141186a36020020012003370320200120023703282001200141206a100e000b0300010bd00201047f230041106b22032400027f20002802002802002202418080c4004704402001411c6a2802002104200128021821052003410036020c027f200241ff004d0440200320023a000c41010c010b200241ff0f4d044020032002413f71418001723a000d20032002410676411f7141c001723a000c41020c010b200241ffff034d044020032002413f71418001723a000e20032002410676413f71418001723a000d20032002410c76410f7141e001723a000c41030c010b2003200241127641f001723a000c20032002413f71418001723a000f20032002410c76413f71418001723a000d20032002410676413f71418001723a000e41040b2102410120052003410c6a2002200428020c1107000d011a0b20002802042d0000044020012802182000280208220028020020002802042001411c6a28020028020c1107000c010b41000b2102200341106a240020020bb10801097f230041d0006b22052400412721060240200028020022004190ce004f04400340200541096a20066a2203417c6a200020004190ce006e220241f0b17f6c6a220841e4006e220741017441ea086a2f00003b00002003417e6a20082007419c7f6c6a41017441ea086a2f00003b00002006417c6a2106200041ffc1d72f4b21032002210020030d000c020b000b200021020b0240200241e4004e0440200541096a2006417e6a22066a2002200241e4006e2200419c7f6c6a41017441ea086a2f00003b00000c010b200221000b0240200041094c0440200541096a2006417f6a22066a2209200041306a3a00000c010b200541096a2006417e6a22066a2209200041017441ea086a2f00003b00000b20054100360234200541b40a3602302005418080c400360238412720066b220721062001280200220041017104402005412b360238200741016a21060b200520004102764101713a003f2001280208210220052005413f6a3602442005200541386a3602402005200541306a360248027f02400240027f0240024002400240024002400240200241014604402001410c6a280200220220064d0d0120004108710d02200220066b2103410120012d0030220020004103461b4103712200450d0320004102460d040c050b200541c0006a2001100c0d082001280218200920072001411c6a28020028020c1107000c0a0b200541c0006a2001100c0d072001280218200920072001411c6a28020028020c1107000c090b200141013a003020014130360204200541c0006a2001100c0d062005413036024c200220066b210620012802182102417f21002001411c6a2802002208410c6a21030340200041016a220020064f0d042002200541cc006a41012003280200110700450d000c070b000b20032104410021030c010b200341016a4101762104200341017621030b2005410036024c2001280204220041ff004d0440200520003a004c41010c030b200041ff0f4b0d0120052000413f71418001723a004d20052000410676411f7141c001723a004c41020c020b2002200920072008410c6a2802001107000d020c030b200041ffff034d044020052000413f71418001723a004e20052000410676413f71418001723a004d20052000410c76410f7141e001723a004c41030c010b2005200041127641f001723a004c20052000413f71418001723a004f20052000410c76413f71418001723a004d20052000410676413f71418001723a004e41040b210220012802182106417f21002001411c6a280200220a410c6a210802400340200041016a220020034f0d012006200541cc006a20022008280200110700450d000c020b000b200541c0006a2001100c0d00200620092007200a410c6a28020022031107000d00417f21000340200041016a220020044f0d022006200541cc006a20022003110700450d000b0b41010c010b41000b2100200541d0006a240020000b4602017f017e230041206b2202240020012902002103200241146a2001290208370200200241ec0b360204200241b40a360200200220003602082002200337020c20021009000b0300010b0c00428a8da6b1cfca94a9200b0b940402004180080bb2032f6465762f66642f3633010100ff010001ff00ffff00010001ff00010100ffff00ff00010100ff010001ff00ffff63616c6c656420604f7074696f6e3a3a756e77726170282960206f6e206120604e6f6e65602076616c75656c6962636f72652f6f7074696f6e2e72733030303130323033303430353036303730383039313031313132313331343135313631373138313932303231323232333234323532363237323832393330333133323333333433353336333733383339343034313432343334343435343634373438343935303531353235333534353535363537353835393630363136323633363436353636363736383639373037313732373337343735373637373738373938303831383238333834383538363837383838393930393139323933393439353936393739383939000000000000010000000000000020000000000000000300000000000000030000000000000003000000010000000100000020000000000000000300000000000000030000000000000003000000696e646578206f7574206f6620626f756e64733a20746865206c656e20697320206275742074686520696e646578206973200041b50b0b540400000a000000250000000c000000000400000a000000250000001d0000002e0400002b00000059040000110000005901000015000000020000000000000001000000030000008005000020000000a005000012".split("").w().map(([a,
b])=>parseInt(a+b,16)));function A(){var a=new WebAssembly.Module(z);this.h=new WebAssembly.Instance(a,{env:{random:Math.random,log:(a)=>console.log("from rust with love: "+a),logf:(a)=>console.log("from rust with love: "+a),powf:Math.pow}});this.h.exports.init();a=this.h.exports.memory;this.l=this.h.exports.address();console.log("address: "+this.l);this.a=new t(new Uint8Array(a.buffer,this.l,1048576),[1024,1024]);this.b=new t(new Uint8Array(a.buffer,this.l+1048576,1048576),[1024,1024])}A.prototype.H=function(){this.h.exports.tick()};function B(){let a=new A,b=a.a,e=a.b;console.log("creating blocks");let c=new t(Array(4096),[64,64]);c.I((a,[c,f])=>new v([c,f],{a:b.window([16*c,16*f],[16,16]),b:e.window([16*c,16*f],[16,16])}));console.log("done");let l=()=>{let b=new Date;a.H();console.log("tick time: "+(new Date-b));setTimeout(l,1E3)};l();return{io:(a)=>{a.on("disconnect",()=>{console.log("Disconnected: "+a.id)});console.log("Connected: "+a.id)},"block/:col/:row":(a,b)=>{b.json(c.get([parseInt(a.params.col),parseInt(a.params.row)]))}}}
;function C(a,b){this.type=a;this.c=b||{};if("trees"==this.type)for(this.c.v=[],a=0;16>a;a++)this.c.v.push("hsl(104,66%,"+(21+20*Math.random())+"%)")}const D={cloud:(a,b)=>{b=[[0,0,32,10],[23,0,10,32],[0,22,32,10],[0,0,10,32]][b.c.direction||0];a.fillStyle="#CADDE3bb";a.fillRect(...b)},rain:(a)=>{a.fillStyle="#77AEEDbb";a.fillRect(12,12,10,10)},trees:(a,b)=>{b.c.v.forEach((b,c)=>{a.fillStyle=b;a.fillRect(c%4*8,8*Math.floor(c/4),8,8)})}};C.prototype.B=function(a){D[this.type](a,this)};const G=(a,b,e,c,l)=>{a.clearRect(0,0,b.width,b.height);let [r,h]=p(e,[0,0]),[f,q]=p(e,[b.width,b.height]);for(b=r;b<=f;b++)for(let c=h;c<=q;c++){var g=l.get(w([b,c]));let f=g.A([b,c]),h=g.b.get(f);g=g.a.get(f);var [E,F]=n(e,[b,c]);a.fillStyle=h>g?"hsl(230,80%,"+Math.floor(32+h/255*40)+"%)":240<g?"hsl(0,0%,"+Math.floor(70+(g-240)/15*20)+"%)":220<g?"hsl(35,48%,"+Math.floor(29+(g-220)/35*-14)+"%)":110<g?"hsl(87,48%,"+Math.floor(40+(g-110)/110*-25)+"%)":"hsl(70,56%,"+Math.floor(55+g/110*-21)+"%)";a.fillRect(E,
F,32,32)}c.forEach(([[b,c],g])=>{a.save();let [f,h]=n(e,[b,c]);a.translate(f,h);g.B(a);a.restore()})};"undefined"!==eval("typeof window")?window.addEventListener("load",()=>{let a,b=new x,e=[[[12,23],new C("cloud",{direction:2})],[[18,24],new C("cloud",{direction:3})],[[14,24],new C("trees")]];a=io({J:!1,transports:["websocket"]});let c=document.getElementById("c"),l=c.getContext("2d"),r=()=>{c.width=window.innerWidth;c.height=window.innerHeight};window.addEventListener("resize",r);r();let h=[0,0],f=null,q=()=>G(l,c,h,e,b);b.addEventListener("update",()=>window.requestAnimationFrame(q));c.addEventListener("mousedown",
(a)=>f=[a.x,a.y]);c.addEventListener("mouseup",()=>f=null);c.addEventListener("mousemove",(a)=>{if(f){let b=[a.x,a.y].sub(f);h=h.sub(b);f=[a.x,a.y];window.requestAnimationFrame(q);h=h.map((a)=>Math.max(a,0))}});(()=>{a.on("start",()=>{console.log("Started")});a.on("connect",()=>{console.log("Connected")});a.on("disconnect",()=>{console.log("Disconnected")});a.on("error",()=>{console.log("Oh shit")})})();q()},!1):module.exports=B();
